<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>test</title>
    <link rel="stylesheet" href="./style.css">
    <script src="./lib/p5.min.js" data-head=""></script><script src="./lib/components/range.js" data-head=""></script>
    <style>
  canvas {
    border: 4px solid;
  }
</style>
  </head>
  <body>
    <main>
      <div id="controls">
  <input type="color" id="stroke">
  <input id="opacity" is="my-range" value="0.5">
  <input id="strokeWidth" is="my-range" value="0.5">
  <input id="bleed" is="my-range" value="0.9">
  <button type="button" id="clear">Clear</button>
</div>
      
      <script id="sketch">
let g, prevWeight, baseWeight, colorInput;
function setup() {
  createCanvas(500, 500);
  strokeCap(PROJECT);
  g = createGraphics(width, height);
  prevWeight = 0;
  baseWeight = 11;
  colorInput = document.getElementById('stroke');
  opacityInput = document.getElementById('opacity');
  widthInput = document.getElementById('strokeWidth');
  bleedInput = document.getElementById('bleed');
  clearButton = document.getElementById("clear");
  clearButton.addEventListener("click", () => {
    colorInput.value = "#000000";
    g.clear()
    clear();
  });
}

function draw() {
  const bleed = 255-(parseFloat(bleedInput.value) * 255);
  background(255, 255, 255, bleed);
  if (mouseIsPressed) {
    let speed = dist(pmouseX, pmouseY, mouseX, mouseY);
    baseWeight = parseFloat(widthInput.value) * 20;
    let targetWeight = map(speed, 0, 50, baseWeight, baseWeight+50);
    
    // Calculate the weight for THIS frame (smoothed)
    let smoothedWeight = lerp(prevWeight, targetWeight, 0.1);
    
    let segments = max(ceil(speed * 2), 1); // Fewer segments needed
    
    // Draw segments with interpolated weights
    for (let i = 0; i < segments; i++) {
      let t1 = i / segments;
      let t2 = (i + 1) / segments;
      
      // Interpolate position
      let x1 = lerp(pmouseX, mouseX, t1);
      let y1 = lerp(pmouseY, mouseY, t1);
      let x2 = lerp(pmouseX, mouseX, t2);
      let y2 = lerp(pmouseY, mouseY, t2);
      
      // Interpolate weight from PREVIOUS frame's weight to THIS frame's weight
      let segmentWeight = lerp(prevWeight, smoothedWeight, (t1 + t2) / 2);
      
      let brushColor = color(colorInput.value);
      let brushOpacity = map(opacityInput.value, 0, 1, 2, 30);
      g.stroke(red(brushColor), green(brushColor), blue(brushColor), brushOpacity);
      g.strokeWeight(segmentWeight);
      g.line(x1, y1, x2, y2);
    }
    
    // Store the smoothed weight for next frame
    prevWeight = smoothedWeight;
  }
  filter(BLUR);
  image(g, 0, 0);
}    

function mouseReleased() {
  prevWeight = 0;
}
</script>
      <script src="./lib/sketches.js"></script>
    </main>
  </body>
</html>
